@if (!editMessageIsOpen) {
  <section class="message" (click)="closeSettings()">
    <div class="message-info">
      <div class="message-user">
        <span class="message-time">{{ formattedCurrMsgTime }} Uhr</span>
        <span class="message-user-name" (click)="openProfile()">{{
          messageUser.name
        }}</span>
      </div>
      <div class="message-box">
        <span class="message-text">{{ currentMessage.text }}</span>
        <div class="reaction-container">
          @for (reaction of currentMessage.reactions; track $index) {
            <div class="reaction">
              <div>{{ reaction.emojiNative }}</div>
              <span>{{ reaction.count }}</span>
            </div>
          }
          <div class="emoji-container">
            <button
              class="message-icon reaction-icon"
              (click)="emojiPickerRight = !emojiPickerRight"
            ></button>
            <emoji-mart
              class="emoji-mart emoji-mart-message-reaction"
              *ngIf="emojiPickerRight"
              (emojiSelect)="selectEmoji($event, emojiPickerRight)"
              title="Choose your emoji"
            ></emoji-mart>
          </div>
        </div>
      </div>
      <!-- {{ allThreads.length }} -->
      <!-- {{ currentMessage.threadReplies }} -->
      @if (currentMessage.threadReplies > 0) {
        <div class="message-answer">
          <button
            class="message-answer-button"
            [routerLink]="[
              '/main',
              currentUserId,
              {
                outlets: {
                  thread: [
                    'channels',
                    currentChannelId,
                    'th',
                    currentMessage.uid
                  ]
                }
              }
            ]"
            (click)="threadService.openThread()"
          >
            {{ currentMessage.threadReplies }}
            <!-- {{ allThreads.length }} -->
            {{ utilityService.getAntwort(allThreads.length) }}
          </button>
          <span class="message-time"
            >Letzte Antwort {{ formattedThreadTime }} Uhr</span
          >
        </div>
      }
    </div>

    <img src="{{ messageUser.profileImage }}" alt="profile-image" />

    <div class="message-bar">
      <div class="message-icon emoji-icon">
        <img
          src="./../../../assets/img/icons/material-symbols/emoji-check.svg"
          alt="check emoji"
        />
      </div>
      <div class="message-icon emoji-icon">
        <img
          src="./../../../assets/img/icons/material-symbols/emoji-hands.svg"
          alt="hands emoji"
        />
      </div>

      <div class="emoji-container">
        <button
          class="message-icon reaction-icon"
          (click)="emojiPickerLeft = !emojiPickerLeft"
        ></button>
        <emoji-mart
          class="emoji-mart emoji-mart-message-right"
          *ngIf="emojiPickerLeft"
          (emojiSelect)="selectEmoji($event, emojiPickerLeft)"
          title="Choose your emoji"
        ></emoji-mart>
      </div>
      @if (threadActive == false) {
        <div
          class="message-icon thread-icon"
          [routerLink]="[
            '/main',
            currentUserId,
            {
              outlets: {
                thread: ['channels', currentChannelId, 'th', currentMessage.uid]
              }
            }
          ]"
          (click)="threadService.openThread()"
        ></div>
      }

      <div
        class="message-icon settings-icon"
        (click)="openSettings()"
        (click)="$event.stopPropagation()"
      >
        <div
          [class]="settingIsOpen ? 'edit-message-button' : 'hidden'"
          (click)="editMessage()"
          (click)="$event.stopPropagation()"
        >
          <span>Nachricht bearbeiten</span>
        </div>
      </div>
    </div>
  </section>
}

@if (editMessageIsOpen) {
  <section class="message" (click)="closeSettings()">
    <div class="edit-message-container">
      <textarea
        class="input-edit-message"
        type="text"
        name="textarea"
        [(ngModel)]="editTextArea"
      ></textarea>
      <div class="edit-message-bottom">
        <div class="emoji-container">
          <button
            class="message-icon edit-reaction-icon"
            (click)="emojiPickerEdit = !emojiPickerEdit"
          ></button>
          <emoji-mart
            class="emoji-mart emoji-mart-message-right"
            *ngIf="emojiPickerEdit"
            (emojiSelect)="addEmoji($event)"
            title="Choose your emoji"
          ></emoji-mart>
        </div>
        <div class="edit-buttons">
          <button class="button-secondary" (click)="closeEditMessage()">
            Abbrechen
          </button>
          <button class="button-primary">Speichern</button>
        </div>
      </div>
    </div>

    <img src="./../../../assets/img/profile/woman2.svg" alt="profile-image" />
  </section>
}
